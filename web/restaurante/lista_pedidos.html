<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedidos</title>
    <link rel="icon" href="../img/favicon.ico" />


    <!--<link rel="stylesheet" href="restaurante.css">-->

    <link rel="stylesheet" type="text/css" href="../css/estilo.css">
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <!-- jQuery and JS bundle w/ Popper.js -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
    <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
    <style>
        table {
            margin-top: 30px;
        }
    </style>
</head>

<body>
    <!-- Nav -->
    <div class="container">
        <nav class="navbar navbar-light bg-light">
            <a class="navbar-brand" href="../index.html"><img src="../img/logo.png" width="130" height="30"
                    class="d-inline-block align-top" alt="" loading="lazy"></a>
            <ul class="nav justify-content-end">
                <li class="nav-item">
                    <a class="nav-link" href="lista_pedidos.html"><i class="fas fa-bars"></i> Pedidos</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="restaurante_opciones.html"><i class="fas fa-cog"></i> Restaurante</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button"
                        aria-haspopup="true" aria-expanded="false"><i class="far fa-user"></i> Nombre Usuario</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="restaurante.html">Mi cuenta</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="../index.html"><i class="fas fa-sign-out-alt"></i> Cerrar
                            Sesión</a>
                    </div>
                </li>
            </ul>
        </nav>
    </div>
    <!-- Nav -->

    <div class="container">
        <h1>Lista de pedidos</h1>
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Paquete</th>
                    <th scope="col">Tipo cocina</th>
                    <th scope="col">Tipo entrega</th>
                    <th scope="col">Fecha</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <!-- Footer -->
    <footer class="page-footer font-small blue-grey lighten-5">

        <!-- Copyright -->
        <div class="footer-copyright text-center text-black-50 py-3 ">
            <div class="col-12 col-md-12 col-lg-10 text-center text-md-center" style="margin: 0 auto;">
                <div class="container">
                    <p class="row">
                        <span class="col-12 col-md-3"><i class="fas fa-home mr-3"></i>Barcelona, BCN 08003, ES</span>
                        <span class="col-12 col-md-3"><i class="fas fa-envelope mr-3"></i>randeat@randeat.com</span>
                        <span class="col-12 col-md-3"><i class="fas fa-phone mr-3"></i>+ 34 634 567 89</span>
                        <span class="col-1 col-md-1" style="margin: 0 auto;"> 
                            <a class="fb-ic" style="text-decoration: none;">
                                <i class="fab fa-facebook-f white-text mr-4"> </i>
                            </a>
                        </span>
                        <span class="col-1 col-md-1" style="margin: 0 auto;">
                            <a class="tw-ic" style="text-decoration: none;">
                                <i class="fab fa-twitter white-text mr-4"> </i>
                            </a>
                        </span>
                        <span class="col-1 col-md-1" style="margin: 0 auto;">
                            <a class="ins-ic" style="text-decoration: none;">
                                <i class="fab fa-instagram white-text"> </i>
                            </a>
                        </span>
                    </p>

                    <div class="group">

                    </div>
                </div>
            </div>
            © 2020 Copyright: RandEat
        </div>
        <!-- Copyright -->
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', function (event) {
            loadPedidos();
        });

        async function loadPaquetes() {
            const response = await fetch(
                "http://localhost:8080/paquete/getAll"
            );
            const json = await response.json();

            let map = new Map();

            await json.map(paquete => {
                map.set(paquete.idPaquete, paquete);
            });

            return map;
        }

        async function loadTipoEntregaMap() {
            const response = await fetch(
                "http://localhost:8080/tipoEntrega/getAll"
            );
            const json = await response.json();

            let map = new Map();
            
            await json.map(tipoEntrega => {
                map.set(
                    tipoEntrega.idTipoEntrega,
                    tipoEntrega
                )
            });

            return map;
        }

        async function loadTipoCocinaMap() {
            const response = await fetch(
                "http://localhost:8080/tipoCocina/getAll"
            );
            const json = await response.json();

            let map = new Map();
            
            await json.map(tipoCocina => {
                map.set(
                    tipoCocina.idTipoCocina,
                    tipoCocina
                )
            });

            return map;
        }

        async function loadPedidos() {
            fetch("http://localhost:8080/pedido/getByIdRestaurante/1")
                .then(resp => resp.json())
                .then(pedidos => {
                    const tipoEntregaMap = loadTipoEntregaMap().then(asd => {return asd});
                    Promise.all([
                        loadTipoEntregaMap(),
                        loadTipoCocinaMap()
                    ]).then(values => {
                        let tipoEntregaMap = values[0];
                        let tipoCocinaMap = values[1];

                        pedidos.map(function (pedido) {
                            console.log(pedido);
                            let tbody = document.getElementsByTagName("tbody")[0];

                            let tr = document.createElement("tr");

                            let thIdPedido = document.createElement("th");
                            thIdPedido.setAttribute("scope", "row");
                            thIdPedido.appendChild(document.createTextNode(pedido.idPedido));
                            tr.appendChild(thIdPedido);

                            let tdPaquete = document.createElement("td");
                            tdPaquete.appendChild(document.createTextNode(
                                // paquetes.get(pedido.paqueteIdPaquete).nombre
                                "Grande x2, Mediano x3, Pequeño x6"
                            ));
                            tr.appendChild(tdPaquete);

                            let tdTipoCocina = document.createElement("td");
                            tdTipoCocina.appendChild(document.createTextNode(
                                tipoCocinaMap    
                                    .get(pedido.tipoCocinaIdTipoCocina)
                                    .nombre
                            ));
                            tr.appendChild(tdTipoCocina);

                            let tdTipoEntrega = document.createElement("td");
                            tdTipoEntrega.appendChild(document.createTextNode(
                                tipoEntregaMap
                                    .get(pedido.tipoEntregaIdTipoEntrega)
                                    .nombre
                            ));
                            tr.appendChild(tdTipoEntrega);

                            let tdFecha = document.createElement("td");
                            tdFecha.appendChild(document.createTextNode(
                                pedido.fecha
                            ));
                            tr.appendChild(tdFecha);

                            tbody.appendChild(tr);
                        });
                    });
                })
            ;
        }
    </script>
</body>

</html>